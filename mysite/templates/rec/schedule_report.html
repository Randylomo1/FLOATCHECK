{% extends 'base.html' %}

{% block title %}Schedule Report for Reconciliation #{{ reconciliation.id }}{% endblock %}

{% block content %}
<div class="container mt-4">
    <a href="{% url 'rec:reconciliation_detail' reconciliation.id %}" class="btn btn-light mb-3">
        <i class="fas fa-arrow-left"></i> Back to Reconciliation Detail
    </a>

    <div class="card">
        <div class="card-header">
            <h4 class="mb-0">Schedule Report for Reconciliation #{{ reconciliation.id }}</h4>
        </div>
        <div class="card-body">
            <form method="post">
                {% csrf_token %}
                <div class="mb-3">
                    <label for="frequency" class="form-label">Frequency</label>
                    <select class="form-select" id="frequency" name="frequency" required>
                        <option value="daily">Daily</option>
                        <option value="weekly">Weekly</option>
                        <option value="monthly">Monthly</option>
                    </select>
                </div>
                <div class="mb-3">
                    <label for="recipient_email" class="form-label">Recipient Email</label>
                    <input type="email" class="form-control" id="recipient_email" name="recipient_email" required>
                </div>
                <button type="submit" class="btn btn-primary">Schedule Report</button>
            </form>
        </div>
    </div>

    <hr>

    <h5 class="mt-4">Scheduled Reports</h5>
    {% if scheduled_reports %}
        <ul class="list-group">
            {% for report in scheduled_reports %}
                <li class="list-group-item d-flex justify-content-between align-items-center">
                    <div>
                        <strong>Frequency:</strong> {{ report.get_frequency_display }}<br>
                        <strong>Recipient:</strong> {{ report.recipient_email }}<br>
                        <strong>Next Run:</strong> {{ report.next_run_at|date:"Y-m-d H:i" }}
                    </div>
                    <form action="{% url 'rec:delete_scheduled_report' report.id %}" method="post" onsubmit="return confirm('Are you sure you want to delete this scheduled report?');">
                        {% csrf_token %}
                        <button type="submit" class="btn btn-danger btn-sm">Delete</button>
                    </form>
                </li>
            {% endfor %}
        </ul>
    {% else %}
        <p>No reports have been scheduled for this reconciliation.</p>
    {% endif %}
</div>
{% endblock %}
